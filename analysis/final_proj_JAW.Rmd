---
title: "Member versus Casual"
date:  "2022-12-2"
author: "Joseph White"
output: html_notebook
---

This notebooks will try to use the `lehdr` package to get at detailed demographic data

## Install lehdr
Run this code only once.
```{r}
#devtools::install_github("jamgreen/lehdr")
```

## Packages
```{r}
library(knitr)
library(tidyverse)
library(janitor)
library(lubridate) # because we will probably see some dates
library(here) # a package I haven't taught you about before that doesn't do much, but ....
library(sf) # working with simple features - geospatial
library(tmap)
library(tidycensus)
library(lehdr)
library(rnaturalearth)
library(WDI)
library(tigris)
library(rgdal)
library(sp)
```


##attempt 4
```{r}
census_api_key("d44395e2fa101f82260fae6b845676d71f017b70")

census=get_acs(geography = "tract",
               variables = c("pop"="B01001_001"),
               state="DC", geometry = TRUE,year=2019)

census_wide = census %>% select(-moe) %>% spread(variable, estimate) %>%
  select(GEOID, pop, geometry) %>% st_transform(4326)
```
```{r}
bikeshare = read_csv("202209-capitalbikeshare-tripdata.csv") %>% clean_names()

bikeshare_start = bikeshare %>% select(member_casual, start_lng, start_lat) %>% st_as_sf(coords=c("start_lng","start_lat"), crs=st_crs(census_wide))

bikeshare_start_member = bikeshare_start %>% filter(member_casual == "member")

bikeshare_start_casual = bikeshare_start %>% filter(member_casual == "casual")

bike_census = census_wide %>% mutate(start_count_member = lengths(st_intersects(., bikeshare_start_member)))

bike_census = bike_census %>% mutate(start_count_casual = lengths(st_intersects(., bikeshare_start_casual)))
```

#plot
```{r}
tmap_mode("view")
tm_shape(bike_census) + tm_polygons(c("start_count_member","start_count_casual"))
```

